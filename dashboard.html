<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inventory Management Web System</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      /* === WELCOME BOX INSIDE SIDEBAR === */
      .welcome-box {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        background: linear-gradient(145deg, #2563eb, #1e3a8a);
        padding: 1rem;
        border-radius: 15px;
        margin-bottom: 1.2rem;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
        animation: fadeIn 1s ease forwards;
        color: white;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .welcome-box::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1),
          transparent 70%
        );
        animation: rotateLight 6s linear infinite;
      }

      @keyframes rotateLight {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      .welcome-icon {
        font-size: 2rem;
        margin-bottom: 0.3rem;
        color: #dbeafe;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.4);
      }

      .welcome-box p {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-bottom: 0.2rem;
        color: #c7d2fe;
      }

      .welcome-box h3 {
        font-size: 1.25rem;
        font-weight: 700;
        background: linear-gradient(90deg, #ffffff, #a5b4fc);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: textGlow 2.5s ease-in-out infinite alternate;
      }

      @keyframes textGlow {
        from {
          text-shadow: 0 0 5px rgba(255, 255, 255, 0.3),
            0 0 10px rgba(59, 130, 246, 0.4);
        }
        to {
          text-shadow: 0 0 15px rgba(255, 255, 255, 0.8),
            0 0 30px rgba(59, 130, 246, 0.6);
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Download button hover fix */
      #downloadReportBtn {
        position: relative;
        z-index: 10;
        background: #2563eb;
        color: white;
        border: none;
        padding: 8px 14px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.3s;
      }

      #downloadReportBtn:hover {
        background: #1d4ed8;
      }
    </style>
  </head>

  <body>
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <h2>IMWS</h2>

      <div class="welcome-box">
        <div class="welcome-icon">üë§</div>
        <p>Welcome,</p>
        <h3 id="usernameDisplay">Guest</h3>
      </div>

      <div class="nav">
        <a href="#" class="active">Dashboard</a>
        <a href="#" onclick="logout()">Logout</a>
      </div>

      <footer>¬© 2025 Inventory Management Web System</footer>
    </aside>

    <!-- MAIN CONTENT -->
    <div class="main-content">
      <header>
        <button class="menu-toggle" id="menuToggle">‚ò∞</button>
        <h1>Inventory Management Web System</h1>
        <button id="addBtn">Add Item</button>
      </header>

      <main>
        <div class="search-bar">
          <input type="text" id="searchInput" placeholder="Search items..." />
        </div>

        <table class="inventory-table">
          <thead>
            <tr>
              <th>No.</th>
              <th>Item Name</th>
              <th>Quantity</th>
              <th>Price</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>

        <p id="itemCount">Total Items: 0</p>

        <section id="report-section">
          <h2>üìä Generate Report</h2>
          <div style="margin-bottom: 8px">
            <button id="downloadReportBtn" class="save-btn">
              ‚¨áÔ∏è Download Reports
            </button>
          </div>
          <div id="report-content"></div>
        </section>
      </main>
    </div>

    <!-- MODAL -->
    <div class="modal" id="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add Item</h2>
          <span id="closeModal" class="close-btn">&times;</span>
        </div>
        <div class="modal-body">
          <div class="input-group">
            <input type="text" id="itemName" placeholder=" " required />
            <label for="itemName">Item Name</label>
          </div>
          <div class="input-group">
            <input
              type="number"
              id="itemQty"
              placeholder=" "
              min="1"
              required
            />
            <label for="itemQty">Quantity</label>
          </div>
          <div class="input-group">
            <input
              type="number"
              id="itemPrice"
              placeholder=" "
              min="0"
              step="0.01"
              required
            />
            <label for="itemPrice">Price</label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel-btn" id="closeModalBtn">Cancel</button>
          <button class="save-btn" id="saveItem">Save</button>
        </div>
      </div>
    </div>

    <script>
      // === SHOW LOGGED-IN USER ===
      document.addEventListener("DOMContentLoaded", () => {
        const usernameDisplay = document.getElementById("usernameDisplay");
        const username = localStorage.getItem("loggedInUser");
        const company = localStorage.getItem("loggedInCompany");

        if (username && company) {
          usernameDisplay.textContent = `${username} (${company})`;
        } else if (username) {
          usernameDisplay.textContent = username;
        } else {
          usernameDisplay.textContent = "Guest";
        }
      });

      // === SIDEBAR TOGGLE ===
      const sidebar = document.getElementById("sidebar");
      const menuToggle = document.getElementById("menuToggle");
      menuToggle.addEventListener("click", () =>
        sidebar.classList.toggle("active")
      );
      document.addEventListener("click", (e) => {
        if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
          sidebar.classList.remove("active");
        }
      });

      // === INVENTORY LOGIC ===
      const addBtn = document.getElementById("addBtn");
      const modal = document.getElementById("modal");
      const closeModalBtn = document.getElementById("closeModal");
      const saveItemBtn = document.getElementById("saveItem");
      const itemName = document.getElementById("itemName");
      const itemQty = document.getElementById("itemQty");
      const itemPrice = document.getElementById("itemPrice");
      const tableBody = document.getElementById("tableBody");
      const searchInput = document.getElementById("searchInput");
      const itemCount = document.getElementById("itemCount");
      const downloadBtn = document.getElementById("downloadReportBtn");

      let items = JSON.parse(localStorage.getItem("inventoryItems")) || [];

      function renderItems() {
        tableBody.innerHTML = "";
        const filtered = items.filter((i) =>
          i.name.toLowerCase().includes(searchInput.value.toLowerCase())
        );
        filtered.forEach((item, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${index + 1}</td>
            <td>${item.name}</td>
            <td>${item.quantity}</td>
            <td>‚Ç±${parseFloat(item.price).toLocaleString("en-PH", {
              minimumFractionDigits: 2,
            })}</td>
            <td><button onclick="editItem(${index})">‚úèÔ∏è</button> 
            <button onclick="deleteItem(${index})">üóëÔ∏è</button></td>
          `;
          tableBody.appendChild(row);
        });
        itemCount.textContent = `Total: ${filtered.length}`;
        generateReport();
      }

      function saveToLocalStorage() {
        localStorage.setItem("inventoryItems", JSON.stringify(items));
      }

      addBtn.onclick = () => (modal.style.display = "flex");
      closeModalBtn.onclick = () => (modal.style.display = "none");
      document.getElementById("closeModalBtn").onclick = () =>
        (modal.style.display = "none");

      saveItemBtn.onclick = () => {
        const name = itemName.value.trim();
        const qty = parseInt(itemQty.value.trim());
        const price = parseFloat(itemPrice.value.trim());
        if (!name || qty <= 0 || isNaN(price))
          return alert("Please fill in valid details!");
        items.push({ name, quantity: qty, price: price.toFixed(2) });
        saveToLocalStorage();
        renderItems();
        modal.style.display = "none";
        alert("Item added successfully!");
      };

      function editItem(index) {
        const newName = prompt("Enter new name:", items[index].name);
        const newQty = prompt("Enter new quantity:", items[index].quantity);
        const newPrice = prompt("Enter new price:", items[index].price);
        if (newName && newQty > 0 && newPrice >= 0) {
          items[index] = {
            name: newName,
            quantity: parseInt(newQty),
            price: parseFloat(newPrice).toFixed(2),
          };
          saveToLocalStorage();
          renderItems();
        }
      }

      function deleteItem(index) {
        if (confirm("Are you sure you want to delete this item?")) {
          items.splice(index, 1);
          saveToLocalStorage();
          renderItems();
        }
      }

      searchInput.addEventListener("input", renderItems);

      function generateReport() {
        const report = document.getElementById("report-content");
        if (items.length === 0) {
          report.innerHTML = "<p>No items available.</p>";
          return;
        }
        const totalQty = items.reduce((sum, i) => sum + Number(i.quantity), 0);
        const totalValue = items.reduce(
          (sum, i) => sum + parseFloat(i.price) * Number(i.quantity),
          0
        );
        const lowStock = items.filter((i) => Number(i.quantity) < 10);

        let html = `
          <p><strong>Total Quantity:</strong> ${totalQty}</p>
          <p><strong>Total Value:</strong> ‚Ç±${totalValue.toLocaleString(
            "en-PH",
            { minimumFractionDigits: 2 }
          )}</p>
          <p><strong>Low Stock Items:</strong> ${lowStock.length}</p>
        `;
        report.innerHTML = html;
      }

      // === DOWNLOAD REPORTS FIXED ===
      downloadBtn.addEventListener("click", () => {
        if (items.length === 0) {
          alert("No data available to download!");
          return;
        }

        let csvContent = "Item Name,Quantity,Price\n";
        items.forEach((item) => {
          csvContent += `${item.name},${item.quantity},${item.price}\n`;
        });

        const blob = new Blob([csvContent], {
          type: "text/csv;charset=utf-8;",
        });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "inventory_report.csv";
        link.click();
      });

      function logout() {
        if (confirm("Are you sure you want to log out?")) {
          localStorage.removeItem("loggedInUser");
          localStorage.removeItem("loggedInCompany");
          alert("You have been logged out!");
          window.location.href = "index.html";
        }
      }

      renderItems();
    </script>
  </body>
</html>
